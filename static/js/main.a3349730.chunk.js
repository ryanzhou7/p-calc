(this["webpackJsonpcreate-react-plus"]=this["webpackJsonpcreate-react-plus"]||[]).push([[0],{110:function(e,t,a){e.exports=a.p+"static/media/63.8a2e2c1e.jpg"},111:function(e,t,a){},114:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(10),c=a.n(i),o=(a(70),a(11)),l=a(122),s=a(119),u=a(120),h=a(121),m=a(53),d=a(54),f=a.n(d),v=a(4);var E={source:null,image:null};var g=a(7),b=a(13),y=a.n(b),x=a(17);function p(e){return{type:"SET_COMBINE_CONTEXT",payload:e}}var O={context:null,numColoredOuterPixels:0,numColoredInnerPixels:0};var _=a(12);a(80);var w=function(e){var t=Object(g.b)(),a=e.image,i=e.canvasDimensions,c=i.canvasWidth,l=i.canvasHeight,s=e.drawDimensions,u=s.drawWidth,h=s.drawHeight,m=Object(o.a)(e.canvasContext,2),d=m[0],f=m[1],v=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=v.current.getContext("2d");t(f(e))}),[]),Object(n.useEffect)((function(){if(null!=a&&null!=d){var e=v.current;e.width=c,e.height=l,d.drawImage(a,0,0,u,h)}}),[a,u,h,c,l]),r.a.createElement("div",{className:"mx-auto"},r.a.createElement("canvas",{ref:v}))},j=a(16),C=a(25),N=function e(t){var a=t.x,n=t.y;Object(C.a)(this,e),this.x=a,this.y=n},S=a(81),T=a(106);function I(e,t,a,n){var r=[];r.push(t);var i=[];i.push(t,t);var c=new Set;for(c.add(t);i.length>0;){var o,l=M(i.pop()),s=Object(j.a)(l);try{for(s.s();!(o=s.n()).done;){var u=o.value,h=L(u.x,u.y);P(u,a)&&!c.has(h)&&R(u,e,t,n)&&(i.push(u),r.push(u)),c.add(h)}}catch(m){s.e(m)}finally{s.f()}}return r}function R(e,t,a,n){return A(t,e,a)<n}function A(e,t,a){var n=e.rgbPixel(t),r=S.rgb.lab([n.r,n.g,n.b]),i={L:r[0],A:r[1],B:r[2]},c=e.rgbPixel(a),o=S.rgb.lab([c.r,c.g,c.b]),l={L:o[0],A:o[1],B:o[2]};return T.getDeltaE00(i,l)}function P(e,t){var a=e.x,n=e.y;return a>0&&a<t.width&&n>0&&n<t.height}var D=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];function M(e){var t,a=[],n=e.x,r=e.y,i=Object(j.a)(D);try{for(i.s();!(t=i.n()).done;){var c=t.value,l=Object(o.a)(c,2),s=l[0],u=l[1];a.push(new N({x:s+n,y:u+r}))}}catch(h){i.e(h)}finally{i.f()}return a}function W(e,t,a,n){var r,i=t.leftX,c=t.rightX,o=t.height,l=0,s=new Set,u=Object(j.a)(n);try{for(u.s();!(r=u.n()).done;)for(var h=r.value,m=h.x,d=h.y;d<o/2;d++){var f=L(m,d),v={x:m,y:d};!s.has(f)&&i<=m&&m<=c&&(s.add(f),e.tint(v,a),l++)}}catch(E){u.e(E)}finally{u.f()}return l}function L(e,t){return String(e)+String(t)}var X=a(56),k=function(){function e(t){var a=t.canvasWidth,n=t.imageArray;Object(C.a)(this,e),this.canvasWidth=a,this.imageArray=n}return Object(X.a)(e,[{key:"rgbPixel",value:function(e){var t=e.x,a=e.y,n=U(t,a,this.canvasWidth)+0,r=U(t,a,this.canvasWidth)+1,i=U(t,a,this.canvasWidth)+2,c=this.imageArray[n],o=this.imageArray[r],l=this.imageArray[i];if(0!==c&&0!==o&&0!==l){var s=U(t,a,this.canvasWidth)+3;this.imageArray[s]}return{r:c,g:o,b:l}}},{key:"rgbaPixel",value:function(e){var t=e.x,a=e.y,n=this.rgbPixel({x:t,y:a}),r=U(t,a,this.canvasWidth)+3,i=this.imageArray[r];return n.alpha=i,n}},{key:"recolor",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=U(i,c,this.canvasWidth)+0,l=U(i,c,this.canvasWidth)+1,s=U(i,c,this.canvasWidth)+2;this.imageArray[o]=Number(a),this.imageArray[l]=Number(n),this.imageArray[s]=Number(r)}},{key:"tint",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=U(i,c,this.canvasWidth)+0,l=U(i,c,this.canvasWidth)+1,s=U(i,c,this.canvasWidth)+2,u=this.imageArray[o],h=this.imageArray[l],m=this.imageArray[s];this.imageArray[o]+=this.tintDelta(u,a),this.imageArray[l]+=this.tintDelta(h,n),this.imageArray[s]+=this.tintDelta(m,r)}},{key:"tintDelta",value:function(e,t){return(t-e)/3}}]),e}();function U(e,t,a){return 4*(e+t*a)}function H(e,t,a,n){var r=e.width,i=e.height,c={detectionWidth:r,detectionHeight:i},o=t.context;o.drawImage(e,0,0,r,i);var l=o.getImageData(0,0,r,i),s=new k({canvasWidth:c.detectionWidth,imageArray:l.data});!function(e,t){for(var a=t.width,n=t.height,r=0,i=0,c=0,o=0;o<a;o++)for(var l=0;l<n/2;l++){if(Math.sqrt(Math.pow(o-200,2)+Math.pow(l-200,2))<188){var s=e.rgbPixel({x:o,y:l});r=Math.max(s.r,r),i=Math.max(s.g,i),c=Math.max(s.b,c)}}for(var u=i/r,h=i/c,m=0;m<a;m++)for(var d=0;d<n/2;d++){var f=e.rgbPixel({x:m,y:d}),v=parseInt(f.r*u),E=f.g,g=parseInt(f.b*h);e.recolor({x:m,y:d},{r:v,g:E,b:g})}}(s,{width:r,height:i});var u=function(e,t){for(var a=t.detectionWidth,n=t.detectionHeight,r=a/2,i={x:r},c=0,o=12;o<n/2;o++){var l={x:r,y:o},s=e.rgbPixel(l),u=2*s.r-s.b-s.g;u>c&&(i.y=o,c=u)}return i}(s,c),h=I(s,u,{width:r,height:i},n),m=function(e,t,a,n){var r=n/2,i=a/2,c=Math.abs(e.y-r),o=e.y,l=c<o,s=o;s+=l?-5:5;var u={x:i},h=Number.MIN_SAFE_INTEGER,m=l?12:r;for(;m!==s;){var d={x:i,y:m},f=t.rgbPixel(d),v=2*f.r-f.b-f.g;v>h&&(u={y:m,x:i},h=v),l?m++:m--}return u}(u,s,r,i),d=h,f=I(s,m,{width:r,height:i},n);if(u.y>m.y){var v=[f,d];d=v[0],f=v[1]}var E=function(e,t){var a=function(e,t){var a,n={top:{left:{x:Number.MAX_SAFE_INTEGER,y:void 0},right:{x:0,y:void 0}},bottom:{left:{x:Number.MAX_SAFE_INTEGER,y:void 0},right:{x:0,y:void 0}}},r=Object(j.a)(e);try{for(r.s();!(a=r.n()).done;){var i=a.value,c=i.x,o=i.y;c<n.top.left.x&&(n.top.left.x=c,n.top.left.y=o),c>n.top.right.x&&(n.top.right.x=c,n.top.right.y=o)}}catch(d){r.e(d)}finally{r.f()}var l,s=Object(j.a)(t);try{for(s.s();!(l=s.n()).done;){var u=l.value,h=u.x,m=u.y;h<n.bottom.left.x&&(n.bottom.left.x=h,n.bottom.left.y=m),h>n.bottom.right.x&&(n.bottom.right.x=h,n.bottom.right.y=m)}}catch(d){s.e(d)}finally{s.f()}return n}(e,t);if(!(a.top.left.y>182&&a.bottom.left.y>182)&&!(a.bottom.left.y>182&&a.top.left.x<a.bottom.left.x)){var n=Math.max(a.top.left.x,a.bottom.left.x);a.top.left.x=n,a.bottom.left.x=n}if(!(a.top.right.y>182&&a.bottom.right.y>182)&&!(a.bottom.right.y>182&&a.top.right.x>a.bottom.right.x)){var r=Math.min(a.top.right.x,a.bottom.right.x);a.top.right.x=r,a.bottom.right.x=r}return a}(d,f),g=W(s,{leftX:E.top.left.x,rightX:E.top.right.x,height:i},{r:0,g:255,b:0},d),b=W(s,{leftX:E.bottom.left.x,rightX:E.bottom.right.x,height:i},{r:0,g:0,b:255},f);return o.putImageData(l,0,0,0,0,c.detectionWidth,c.detectionHeight),{topPixelsCount:g,bottomPixelsCount:b}}function F(e){return new Promise((function(t){for(var a=new Map,n=0,r=20,i=25;i>=5;i--){var c=e(i),o=parseInt(c),l=a.has(o)?a.get(o):0;l++,a.set(o,l),l>=n&&(n=l,r=i)}t(r)}))}var G=function(e){var t,a=Object(g.b)(),i=Object(g.c)((function(e){return e.combinedCanvasInfo})),c=Object(g.c)((function(e){return e.image.source})),l=Object(g.c)((function(e){return e.image.image})),s=Object(o.a)(e.thresholdState,2),m=s[0],d=s[1],f=i.numColoredOuterPixels,E=i.numColoredInnerPixels,b=e.webcamContainerRef,O=Object(o.a)(e.cameraState,2)[1],j=Object(v.a)({},e,{canvasContext:[i.context,p]});function C(e){d((function(t){return Math.max(0,t+e)}))}function N(e){var t=H(c,i,0,e),n=t.topPixelsCount,r=t.bottomPixelsCount;return a({type:"SET_NUM_COLORED_OUTER_PIXELS",payload:n}),a({type:"SET_NUM_COLORED_INNER_PIXELS",payload:r}),100*(n-r)/n}return Object(n.useRef)(null),Object(n.useEffect)((function(){function e(){return(e=Object(x.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=5;break}return e.next=3,F(N);case 3:t=e.sent,d(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[c]),Object(n.useEffect)((function(){c&&N(m)}),[m]),r.a.createElement(r.a.Fragment,null,r.a.createElement(u.a,null,c&&r.a.createElement("h2",{className:"card-title"},"Results"),r.a.createElement("div",null,r.a.createElement(w,j),c&&r.a.createElement("div",{className:"d-flex justify-content-around align-items-center mb-4"},r.a.createElement("div",null,r.a.createElement(h.a,{variant:"outline-primary",onClick:function(){O(!0),window.scrollTo(0,b.current.offsetTop)}},"Retake picture"),r.a.createElement("div",null,r.a.createElement("h3",{className:"mt-4"},"Loss:"," ",(100*((t=f)-E)/t).toFixed(2),"%"),r.a.createElement("div",{className:"mt-4"},r.a.createElement(h.a,{variant:"outline-primary",onClick:function(){var e=new Date;!function(e,t){var a=document.createElement("a");a.href=e,a.download=t+".jpeg",a.click()}(l,e.toDateString())}},"Download original")," "))),r.a.createElement(u.a,null,r.a.createElement(u.a.Body,null,r.a.createElement(u.a.Title,null,"Sensitivity: ",m),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-around mb-3"},r.a.createElement(h.a,{onClick:function(e){C(-1)}},r.a.createElement(_.a,{icon:"minus",size:"1x"})),r.a.createElement(h.a,{onClick:function(e){C(1)}},r.a.createElement(_.a,{icon:"plus",size:"1x"}))),r.a.createElement("div",{className:"row justify-content-between"},r.a.createElement(h.a,{className:"mr-1",onClick:function(e){C(-3)}},r.a.createElement(_.a,{icon:"minus",size:"1x"}),"  ",r.a.createElement(_.a,{icon:"minus",size:"1x"})),r.a.createElement(h.a,{onClick:function(e){C(3)}},r.a.createElement(_.a,{icon:"plus",size:"1x"}),"  ",r.a.createElement(_.a,{icon:"plus",size:"1x"}))))))))))},z=a(58),B=a.n(z);a(110),a(111);var q=Object(m.withOrientationChange)((function(e){var t=Object(g.b)(),a=Object(n.useState)(20),i=Object(o.a)(a,2),c=i[0],m=i[1],d=Object(n.useState)(!0),v=Object(o.a)(d,2),E=v[0],b=v[1],y=Object(g.c)((function(e){return e.videoReducer.videoConstraints})),x=Object(g.c)((function(e){return e.image.source})),p=Object(g.c)((function(e){return e.canvasSettings.canvasDimensions})),O=(Object(g.c)((function(e){return e.combinedCanvasInfo})),e.isPortrait),w=Object(n.useRef)(null),j=Object(n.useRef)(null),C=Object(n.useRef)(null);Object(n.useEffect)((function(){}),[]);var N=function(){if(E){var e,a=j.current.getScreenshot();t((e=a,function(t){var a=new Image;a.onload=function(){t({type:"IMAGE_SOURCE_SET",payload:a})},a.src=e})),t(function(e){return{type:"IMAGE_SET",payload:e}}(a)),window.scrollTo(0,C.current.offsetTop),b(!1)}else b(!0)},S={webcamRef:j,webcamContainerRef:w,image:x,canvasDimensions:{canvasWidth:p.width,canvasHeight:p.height},drawDimensions:{drawWidth:p.width,drawHeight:p.height},isPortrait:O,thresholdState:[c,m],cameraState:[E,b]},T=r.a.createElement(l.a,{id:"popover-basic"},r.a.createElement(l.a.Content,null,"Draw your chart with red sharpie. Align the red target's circle concentrically with the chart's smallest circle that still encompasses all of the the drawn lines for increased accuracy. Also ensure the target cross is aligned with the chart. Camera focus will happen automatically. Tap the (?) again to close this popover."));return r.a.createElement("div",{className:"App mt-2"},r.a.createElement("h2",{className:"card-title",style:{display:"inline"}},"Capture chart"," "),r.a.createElement(s.a,{trigger:"click",placement:"bottom",overlay:T},r.a.createElement(_.a,{icon:"question-circle",size:"2x"})),r.a.createElement(u.a,{className:"mt-4"},r.a.createElement("div",{className:"mx-auto"},r.a.createElement("div",{className:"capture-container mx-auto",ref:w},E&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{ref:j,audio:!1,height:y.height,screenshotFormat:"image/jpeg",width:y.width,videoConstraints:y}),r.a.createElement("div",{className:"overlay"},r.a.createElement("img",{className:"target",style:{width:y.width-20},src:B.a}))))),r.a.createElement("div",{className:"my-2 z-top mx-auto"},r.a.createElement(h.a,{className:"capture-button",onClick:function(){return N()}},r.a.createElement(_.a,{icon:"camera",size:"3x"})))),r.a.createElement("div",{className:"mt-4",ref:C},r.a.createElement(G,S)),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null))})),J=a(20),Q=a(59),V=a(21);J.b.add(Q.a,V.b,V.c,V.a,V.d);var $=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(q,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(113);var K=a(19),Y=a(60);var Z={isOuterEdit:!0};var ee={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#00FF00"};var te={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#FFA500"};var ae={canvasDimensions:{width:400,height:400}};var ne={videoConstraints:{width:400,height:400,facingMode:{exact:"environment"},audio:!1,imageSmoothing:!0,screenshotQuality:1}};var re=Object(K.c)({image:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IMAGE_SOURCE_SET":return Object(v.a)({},e,{source:t.payload});case"IMAGE_SET":return Object(v.a)({},e,{image:t.payload});default:return e}},canvasEdit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_IS_OUTER_EDIT":return Object(v.a)({},e,{isOuterEdit:!e.isOuterEdit});default:return e}},innerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INNER_CONTEXT":return Object(v.a)({},e,{context:t.payload});case"SET_INNER_RECOLORED_IMAGE_DATA":return Object(v.a)({},e,{recoloredImageData:t.payload});case"SET_INNER_DETECTED_PIXELS":return Object(v.a)({},e,{detectedPixels:t.payload});case"SET_INNER_NUM_COLORED_PIXELS":return Object(v.a)({},e,{numColoredPixels:t.payload});case"SET_INNER_RECOLOR_HEX":return Object(v.a)({},e,{recolorHex:t.payload});default:return e}},outerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OUTER_CONTEXT":return Object(v.a)({},e,{context:t.payload});case"SET_OUTER_RECOLORED_IMAGE_DATA":return Object(v.a)({},e,{recoloredImageData:t.payload});case"SET_OUTER_DETECTED_PIXELS":return Object(v.a)({},e,{detectedPixels:t.payload});case"SET_OUTER_NUM_COLORED_PIXELS":return Object(v.a)({},e,{numColoredPixels:t.payload});case"SET_OUTER_RECOLOR_HEX":return Object(v.a)({},e,{recolorHex:t.payload});default:return e}},combinedCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_COMBINE_CONTEXT":return Object(v.a)({},e,{context:t.payload});case"SET_NUM_COLORED_INNER_PIXELS":return Object(v.a)({},e,{numColoredInnerPixels:t.payload});case"SET_NUM_COLORED_OUTER_PIXELS":return Object(v.a)({},e,{numColoredOuterPixels:t.payload});default:return e}},canvasSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CANVAS_DIMENSIONS":return Object(v.a)({},e,{source:t.payload});default:return e}},videoReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=arguments.length>1?arguments[1]:void 0;return t.type,e}}),ie=Object(K.d)(re,Object(K.a)(Y.a));c.a.render(r.a.createElement(g.a,{store:ie},r.a.createElement($,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},58:function(e,t,a){e.exports=a.p+"static/media/circle.9036c121.png"},65:function(e,t,a){e.exports=a(114)},70:function(e,t,a){},80:function(e,t,a){}},[[65,1,2]]]);
//# sourceMappingURL=main.a3349730.chunk.js.map