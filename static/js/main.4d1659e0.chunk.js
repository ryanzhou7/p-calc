(this["webpackJsonpcreate-react-plus"]=this["webpackJsonpcreate-react-plus"]||[]).push([[0],{39:function(e,t,a){e.exports=a.p+"static/media/thick-half.34a74ea6.png"},42:function(e,t,a){e.exports=a(89)},47:function(e,t,a){},56:function(e,t,a){},86:function(e,t,a){},87:function(e,t,a){e.exports=a.p+"static/media/7.787a2096.jpeg"},89:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(15),c=a.n(i),o=(a(47),a(91)),s=a(34),u=a(35),l=a.n(u),h=a(2);var d={source:null,image:null};var f=a(6),m=a(1),v=a.n(m),g=a(4),p=a(10);function E(e){return{type:"SET_COMBINE_CONTEXT",payload:e}}function y(e){return{type:"SET_NUM_COLORED_INNER_PIXELS",payload:e}}function b(e){return{type:"SET_NUM_COLORED_OUTER_PIXELS",payload:e}}var O={context:null,numColoredOuterPixels:0,numColoredInnerPixels:0};a(56);var x=function(e){var t=Object(f.b)(),a=e.image,i=e.canvasDimensions,c=i.canvasWidth,o=i.canvasHeight,s=e.drawDimensions,u=s.drawWidth,l=s.drawHeight,h=Object(p.a)(e.canvasContext,2),d=h[0],m=h[1],v=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=v.current.getContext("2d");t(m(e))}),[]),Object(n.useEffect)((function(){if(null!=a&&null!=d){var e=v.current;e.width=c,e.height=o,d.drawImage(a,0,0,u,l)}}),[a,u,l,c,o]),r.a.createElement("div",null,r.a.createElement("canvas",{ref:v,className:"border"}))},_=a(9),j=a(16),w=function e(t){var a=t.x,n=t.y;Object(j.a)(this,e),this.x=a,this.y=n},C=a(37),I=function(){function e(t){var a=t.canvasWidth,n=t.imageArray;Object(j.a)(this,e),this.canvasWidth=a,this.imageArray=n}return Object(C.a)(e,[{key:"rgbPixel",value:function(e){var t=e.x,a=e.y,n=T(t,a,this.canvasWidth)+0,r=T(t,a,this.canvasWidth)+1,i=T(t,a,this.canvasWidth)+2,c=this.imageArray[n],o=this.imageArray[r],s=this.imageArray[i];if(0!==c&&0!==o&&0!==s){var u=T(t,a,this.canvasWidth)+3;this.imageArray[u]}return{r:c,g:o,b:s}}},{key:"rgbaPixel",value:function(e){var t=e.x,a=e.y,n=this.rgbPixel({x:t,y:a}),r=T(t,a,this.canvasWidth)+3,i=this.imageArray[r];return n.alpha=i,n}},{key:"recolor",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=T(i,c,this.canvasWidth)+0,s=T(i,c,this.canvasWidth)+1,u=T(i,c,this.canvasWidth)+2;this.imageArray[o]=Number(a),this.imageArray[s]=Number(n),this.imageArray[u]=Number(r)}},{key:"rRelative",value:function(e){var t=this.rgbPixel(e);t.r,t.g;return t.b}},{key:"tint",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=T(i,c,this.canvasWidth)+0,s=T(i,c,this.canvasWidth)+1,u=T(i,c,this.canvasWidth)+2,l=this.imageArray[o],h=this.imageArray[s],d=this.imageArray[u];this.imageArray[o]+=this.tintDelta(l,a),this.imageArray[s]+=this.tintDelta(h,n),this.imageArray[u]+=this.tintDelta(d,r)}},{key:"tintDelta",value:function(e,t){return(t-e)/3}}]),e}();function T(e,t,a){return 4*(e+t*a)}var N=a(57),S=a(82);function R(e,t,a,n,r){return A.apply(this,arguments)}function A(){return(A=Object(g.a)(v.a.mark((function e(t,a,n,r,i){var c,o,s,u,l,h,d,f,m;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a.x,a.y,(c=[]).push(a),(o=[]).push(a),(s=new Set).add(a);o.length>0;){u=o.pop(),X(u.x,u.y),l=k(u),h=Object(_.a)(l);try{for(h.s();!(d=h.n()).done;)f=d.value,m=X(f.x,f.y),P(f,r)&&!s.has(m)&&D(u,f,t,a,i)&&(o.push(f),c.push(f)),s.add(m)}catch(n){h.e(n)}finally{h.f()}}return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,a,n,r){var i=a.rgbPixel(n),c=N.rgb.lab([i.r,i.g,i.b]),o={L:c[0],A:c[1],B:c[2]},s=a.rgbPixel(e),u=a.rgbPixel(t),l=N.rgb.lab([s.r,s.g,s.b]),h=N.rgb.lab([u.r,u.g,u.b]),d=(l[0],l[1],l[2],{L:h[0],A:h[1],B:h[2]});return S.getDeltaE00(o,d)<r}function P(e,t){var a=e.x,n=e.y;return a>0&&a<t.width&&n>0&&n<t.height}var M=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];function k(e){var t,a=[],n=e.x,r=e.y,i=Object(_.a)(M);try{for(i.s();!(t=i.n()).done;){var c=t.value,o=Object(p.a)(c,2),s=o[0],u=o[1];a.push(new w({x:s+n,y:u+r}))}}catch(l){i.e(l)}finally{i.f()}return a}function W(e,t,a,n){return L.apply(this,arguments)}function L(){return(L=Object(g.a)(v.a.mark((function e(t,a,n,r){var i,c,o,s,u,l,h,d,f,m,g,p,E;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.leftX,c=a.rightX,o=a.height,s=0,u=new Set,l=Object(_.a)(r);try{for(l.s();!(h=l.n()).done;)for(d=h.value,f=d.x,m=d.y,g=m;g<o/2;g++)p=X(f,g),E={x:f,y:g},!u.has(p)&&i<=f&&f<=c&&(u.add(p),t.tint(E,n),s++)}catch(v){l.e(v)}finally{l.f()}return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t){return String(e)+String(t)}var U=a(12),H=a.n(U);function G(e,t){return F.apply(this,arguments)}function F(){return(F=Object(g.a)(v.a.mark((function e(t,a){var n,r,i,c,o,s,u,l,h;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.width,r=t.height,a.drawImage(t,0,0,n,r),i=a.getImageData(0,0,n,r),450,320,c=H.a.U8_t,o=new H.a.matrix_t(450,320,c),H.a.imgproc.grayscale(i.data,n,r,o),3,8,120,120,H.a.imgproc.gaussian_blur(o,o,8,0),H.a.imgproc.canny(o,o,120,120),s=new Uint32Array(i.data.buffer),255<<24,u=o.cols*o.rows,l=0;--u>=0;)l=o.data[u],s[u]=255<<24|l<<16|l<<8|l;return a.putImageData(i,0,0,0,0,n,r),h=new I({canvasWidth:n,imageArray:i.data}),e.abrupt("return",h);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t,a,n){return J.apply(this,arguments)}function J(){return(J=Object(g.a)(v.a.mark((function e(t,a,n,r){var i,c,o,s,u,l,h,d,f,m,g,p,E,y,b,O,x,_,j,w,C,T;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.width,c=t.height,o={detectionWidth:i,detectionHeight:c},s=n.current,u=s.getContext("2d"),e.next=6,G(t,u);case 6:return l=e.sent,(h=a.context).drawImage(t,0,0,i,c),d=h.getImageData(0,0,i,c),f=new I({canvasWidth:o.detectionWidth,imageArray:d.data}),e.next=13,$(f,o);case 13:return m=e.sent,e.next=16,R(f,m,l,{width:i,height:c},r);case 16:return g=e.sent,e.next=19,Q(m,g,f,i,c);case 19:return p=e.sent,e.next=22,R(f,p,l,{width:i,height:c},r);case 22:return E=e.sent,console.log("max: "+g.length),console.log("next: "+E.length),y=g,b=E,m.y>p.y&&(y=(O=[b,y])[0],b=O[1]),e.next=30,z(y,b);case 30:return x=e.sent,_=x.left,j=x.right,w={r:0,g:255,b:0},e.next=36,W(f,{leftX:_,rightX:j,height:c},w,y);case 36:return C=e.sent,e.next=39,W(f,{leftX:_,rightX:j,height:c},{r:0,g:0,b:255},b);case 39:return T=e.sent,h.putImageData(d,0,0,0,0,o.detectionWidth,o.detectionHeight),e.abrupt("return",Promise.resolve({topPixelsCount:C,bottomPixelsCount:T,context:h}));case 42:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t,a,n,r){return V.apply(this,arguments)}function V(){return(V=Object(g.a)(v.a.mark((function e(t,a,n,r,i){var c,o,s,u,l,h,d,f,m,g,p,E,y,b;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=i/2,o=r/2,s=Math.abs(t.y-c),u=t.y,h=u,(l=s<u)?Math.max:Math.min,d=Object(_.a)(a);try{for(d.s();!(f=d.n()).done;)f.value.y}catch(v){d.e(v)}finally{d.f()}for(h+=l?-10:10,m={x:o},g=Number.MIN_SAFE_INTEGER,p=l?0:c;p!==h;)E={x:o,y:p},y=n.rgbPixel(E),(b=2*y.r-y.b-y.g)>g&&(m={y:p,x:o},g=b),l?p++:p--;return e.abrupt("return",m);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return q.apply(this,arguments)}function q(){return(q=Object(g.a)(v.a.mark((function e(t,a){var n,r,i,c,o,s,u,l,h;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.detectionWidth,r=a.detectionHeight,c={x:i=n/2},o=0,s=0;s<r/2;s++)u={x:i,y:s},l=t.rgbPixel(u),(h=2*l.r-l.b-l.g)>o&&(c.y=s,o=h);return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return K.apply(this,arguments)}function K(){return(K=Object(g.a)(v.a.mark((function e(t,a){var n,r,i,c,o,s,u,l,h,d,f,m;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Number.MAX_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,i=0,c=0,o=Object(_.a)(t);try{for(o.s();!(s=o.n()).done;)u=s.value,l=u.x,n=Math.min(n,l),i=Math.max(i,l)}catch(v){o.e(v)}finally{o.f()}h=Object(_.a)(a);try{for(h.s();!(d=h.n()).done;)f=d.value,m=f.x,r=Math.min(r,m),c=Math.max(c,m)}catch(v){h.e(v)}finally{h.f()}return e.abrupt("return",{left:Math.max(n,r),right:Math.min(i,c)});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y=function(e){var t,a=Object(f.b)(),i=(Object(f.c)((function(e){return e.outerCanvasInfo})),Object(f.c)((function(e){return e.innerCanvasInfo})),Object(f.c)((function(e){return e.combinedCanvasInfo}))),c=(Object(f.c)((function(e){return e.canvasSettings.canvasDimensions})),Object(f.c)((function(e){return e.image.source}))),s=Object(f.c)((function(e){return e.image.image})),u=Object(n.useState)(20),l=Object(p.a)(u,2),d=l[0],m=l[1],O=i.numColoredOuterPixels,_=i.numColoredInnerPixels,j=e.webcamRef,w=Object(h.a)({},e,{canvasContext:[i.context,E]}),C=Object(n.useRef)(null),I=function(e){var t=Math.max(0,d+e);m(t)};function T(){return N.apply(this,arguments)}function N(){return(N=Object(g.a)(v.a.mark((function e(){var t,n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(c,i,C,d);case 2:t=e.sent,n=t.topPixelsCount,r=t.bottomPixelsCount,a(b(n)),a(y(r));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){c&&T()}),[c]),r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex justify-content-around align-items-center"},r.a.createElement(x,w),r.a.createElement("canvas",{style:{display:"none"},ref:C}),r.a.createElement("div",null,r.a.createElement(o.a,{className:"my-1",variant:"outline-primary",onClick:function(){window.scrollTo(0,j.current.offsetTop)}},"Retake"),r.a.createElement("div",{className:"my-4"},r.a.createElement(o.a,{className:"mr-2",onClick:function(){I(-5),T()}},"Detect less"),r.a.createElement(o.a,{onClick:function(){I(5),T()}},"Detect more")),r.a.createElement(o.a,{variant:"outline-primary",onClick:function(){!function(e,t){var a=document.createElement("a");a.href=e,a.download=t+".jpeg",a.click()}(s,"close")}},"Download")),r.a.createElement("div",{className:"mt-4"},"Loss:"," ",(100*((t=O)-_)/t).toFixed(4),"%")))},Z=a(39),ee=a.n(Z);a(86),a(87);var te=Object(s.withOrientationChange)((function(e){var t=Object(f.b)(),a=Object(f.c)((function(e){return e.videoReducer.videoConstraints})),i=Object(f.c)((function(e){return e.image.source})),c=Object(f.c)((function(e){return e.canvasSettings.canvasDimensions})),s=e.isPortrait,u=Object(n.useRef)(null),h=Object(n.useRef)(null),d=Object(n.useRef)(null);Object(n.useEffect)((function(){}),[]);var m=Object(n.useCallback)((function(){var e,a=u.current.getScreenshot();t((e=a,function(t){var a=new Image;a.onload=function(){t({type:"IMAGE_SOURCE_SET",payload:a})},a.src=e})),t(function(e){return{type:"IMAGE_SET",payload:e}}(a)),window.scrollTo(0,d.current.offsetTop)}),[u]),v={webcamRef:u,image:i,canvasDimensions:{canvasWidth:c.width,canvasHeight:c.height},drawDimensions:{drawWidth:c.width,drawHeight:c.height}};return r.a.createElement("div",{className:"App"},r.a.createElement("h2",null,"Ptosis calculator"),s&&r.a.createElement("h5",null,"Please rotate your device"),!s&&r.a.createElement("div",{className:"d-flex justify-content-around align-items-center",ref:h},r.a.createElement("div",{style:{position:"relative",float:"top"}},r.a.createElement(l.a,{audio:!1,height:a.height,ref:u,screenshotFormat:"image/jpeg",width:a.width,videoConstraints:a}),r.a.createElement("div",{className:"overlay"},r.a.createElement("img",{className:"target",style:{height:a.height},src:ee.a}))),r.a.createElement("div",{className:"my-3"},r.a.createElement(o.a,{onClick:function(){return m()}},"Take picture"))),r.a.createElement("div",{ref:d},r.a.createElement(Y,v)))}));var ae=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(te,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(88);var ne=a(11),re=a(40);var ie={isOuterEdit:!0};var ce={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#00FF00"};var oe={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#FFA500"};var se={canvasDimensions:{width:450,height:320}};var ue={videoConstraints:{width:450,height:320,facingMode:{exact:"environment"},audio:!1,imageSmoothing:!0,screenshotQuality:1}};var le=Object(ne.c)({image:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IMAGE_SOURCE_SET":return Object(h.a)({},e,{source:t.payload});case"IMAGE_SET":return Object(h.a)({},e,{image:t.payload});default:return e}},canvasEdit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_IS_OUTER_EDIT":return Object(h.a)({},e,{isOuterEdit:!e.isOuterEdit});default:return e}},innerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INNER_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_INNER_RECOLORED_IMAGE_DATA":return Object(h.a)({},e,{recoloredImageData:t.payload});case"SET_INNER_DETECTED_PIXELS":return Object(h.a)({},e,{detectedPixels:t.payload});case"SET_INNER_NUM_COLORED_PIXELS":return Object(h.a)({},e,{numColoredPixels:t.payload});case"SET_INNER_RECOLOR_HEX":return Object(h.a)({},e,{recolorHex:t.payload});default:return e}},outerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OUTER_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_OUTER_RECOLORED_IMAGE_DATA":return Object(h.a)({},e,{recoloredImageData:t.payload});case"SET_OUTER_DETECTED_PIXELS":return Object(h.a)({},e,{detectedPixels:t.payload});case"SET_OUTER_NUM_COLORED_PIXELS":return Object(h.a)({},e,{numColoredPixels:t.payload});case"SET_OUTER_RECOLOR_HEX":return Object(h.a)({},e,{recolorHex:t.payload});default:return e}},combinedCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_COMBINE_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_NUM_COLORED_INNER_PIXELS":return Object(h.a)({},e,{numColoredInnerPixels:t.payload});case"SET_NUM_COLORED_OUTER_PIXELS":return Object(h.a)({},e,{numColoredOuterPixels:t.payload});default:return e}},canvasSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CANVAS_DIMENSIONS":return Object(h.a)({},e,{source:t.payload});default:return e}},videoReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;return t.type,e}}),he=Object(ne.d)(le,Object(ne.a)(re.a));c.a.render(r.a.createElement(f.a,{store:he},r.a.createElement(ae,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[42,1,2]]]);
//# sourceMappingURL=main.4d1659e0.chunk.js.map