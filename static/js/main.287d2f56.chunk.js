(this["webpackJsonpcreate-react-plus"]=this["webpackJsonpcreate-react-plus"]||[]).push([[0],{25:function(e,t,a){e.exports=a.p+"static/media/thick-half.34a74ea6.png"},26:function(e,t,a){e.exports=a.p+"static/media/image-5.787a2096.jpeg"},29:function(e,t,a){e.exports=a(59)},34:function(e,t,a){},43:function(e,t,a){},57:function(e,t,a){},59:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(11),c=a.n(i),o=(a(34),a(61)),u=a(20),s=a(21),l=a.n(s),h=a(2);function d(e){return function(t){var a=new Image;a.onload=function(){t({type:"IMAGE_SOURCE_SET",payload:a})},a.src=e}}var f={source:null,image:null};var m=a(5),v=a(1),g=a.n(v),p=a(3);function y(e){return{type:"SET_COMBINE_CONTEXT",payload:e}}var E={context:null,numColoredOuterPixels:0,numColoredInnerPixels:0};var b=a(9);a(43);var O=function(e){var t=Object(m.b)(),a=e.image,i=e.canvasDimensions,c=i.canvasWidth,o=i.canvasHeight,u=e.drawDimensions,s=u.drawWidth,l=u.drawHeight,h=Object(b.a)(e.canvasContext,2),d=h[0],f=h[1],v=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=v.current.getContext("2d");t(f(e))}),[]),Object(n.useEffect)((function(){if(null!=a&&null!=d){var e=v.current;e.width=c,e.height=o,d.drawImage(a,0,0,s,l)}}),[a,s,l,c,o]),r.a.createElement("div",null,r.a.createElement("canvas",{ref:v,className:"border"}))},x=a(7),w=a(12),j=function e(t){var a=t.x,n=t.y;Object(w.a)(this,e),this.x=a,this.y=n},_=a(23),C=function(){function e(t){var a=t.canvasWidth,n=t.imageArray;Object(w.a)(this,e),this.canvasWidth=a,this.imageArray=n}return Object(_.a)(e,[{key:"rgbPixel",value:function(e){var t=e.x,a=e.y,n=I(t,a,this.canvasWidth)+0,r=I(t,a,this.canvasWidth)+1,i=I(t,a,this.canvasWidth)+2,c=this.imageArray[n],o=this.imageArray[r],u=this.imageArray[i];if(0!==c&&0!==o&&0!==u){var s=I(t,a,this.canvasWidth)+3;this.imageArray[s]}return{r:c,g:o,b:u}}},{key:"rgbaPixel",value:function(e){var t=e.x,a=e.y,n=this.rgbPixel({x:t,y:a}),r=I(t,a,this.canvasWidth)+3,i=this.imageArray[r];return n.alpha=i,n}},{key:"recolor",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=I(i,c,this.canvasWidth)+0,u=I(i,c,this.canvasWidth)+1,s=I(i,c,this.canvasWidth)+2;this.imageArray[o]=Number(a),this.imageArray[u]=Number(n),this.imageArray[s]=Number(r)}},{key:"rRelative",value:function(e){var t=this.rgbPixel(e);t.r,t.g;return t.b}},{key:"tint",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=I(i,c,this.canvasWidth)+0,u=I(i,c,this.canvasWidth)+1,s=I(i,c,this.canvasWidth)+2,l=this.imageArray[o],h=this.imageArray[u],d=this.imageArray[s];this.imageArray[o]+=this.tintDelta(l,a),this.imageArray[u]+=this.tintDelta(h,n),this.imageArray[s]+=this.tintDelta(d,r)}},{key:"tintDelta",value:function(e,t){return(t-e)/3}}]),e}();function I(e,t,a){return 4*(e+t*a)}var T=a(44),A=a(53);function N(e,t,a,n){return S.apply(this,arguments)}function S(){return(S=Object(p.a)(g.a.mark((function e(t,a,n,r){var i,c,o,u,s,l,h,d,f;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a.x,a.y,(i=[]).push(a),(c=[]).push(a),(o=new Set).add(a),0;c.length>0;){u=c.pop(),L(u.x,u.y),s=k(u),l=Object(x.a)(s);try{for(l.s();!(h=l.n()).done;)d=h.value,f=L(d.x,d.y),D(d,r)&&!o.has(f)&&R(u,d,t,a)&&(c.push(d),i.push(d)),o.add(f)}catch(n){l.e(n)}finally{l.f()}0}return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t,a,n){var r=a.rgbPixel(n),i=a.rgbPixel(t),c=T.rgb.lab(r.r,r.g,r.b),o=T.rgb.lab(i.r,i.g,i.b),u={L:c[0],A:c[1],B:c[2]},s={L:o[0],A:o[1],B:o[2]};return A.getDeltaE00(u,s)<20}function D(e,t){var a=e.x,n=e.y;return a>0&&a<t.width&&n>0&&n<t.height}var P=[[-1,0],[0,-1],[0,1],[1,0]];function k(e){var t,a=[],n=e.x,r=e.y,i=Object(x.a)(P);try{for(i.s();!(t=i.n()).done;){var c=t.value,o=Object(b.a)(c,2),u=o[0],s=o[1];a.push(new j({x:u+n,y:s+r}))}}catch(l){i.e(l)}finally{i.f()}return a}function M(e,t,a,n){return W.apply(this,arguments)}function W(){return(W=Object(p.a)(g.a.mark((function e(t,a,n,r){var i,c,o,u,s,l,h,d,f,m,v,p,y;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.leftX,c=a.rightX,o=a.height,u=0,s=new Set,l=Object(x.a)(r);try{for(l.s();!(h=l.n()).done;)for(d=h.value,f=d.x,m=d.y,v=m;v<o/2;v++)p=L(f,v),y={x:f,y:v},!s.has(p)&&i<=f&&f<=c&&(s.add(p),t.tint(y,n),u++)}catch(g){l.e(g)}finally{l.f()}return e.abrupt("return",u);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return String(e)+String(t)}var X=a(10),U=a.n(X);function H(e,t){return F.apply(this,arguments)}function F(){return(F=Object(p.a)(g.a.mark((function e(t,a){var n,r,i,c,o,u,s,l,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.width,r=t.height,a.drawImage(t,0,0,n,r),i=a.getImageData(0,0,n,r),450,320,c=U.a.U8_t,o=new U.a.matrix_t(450,320,c),U.a.imgproc.grayscale(i.data,n,r,o),3,8,120,120,U.a.imgproc.gaussian_blur(o,o,8,0),U.a.imgproc.canny(o,o,120,120),u=new Uint32Array(i.data.buffer),255<<24,s=o.cols*o.rows,l=0;--s>=0;)l=o.data[s],u[s]=255<<24|l<<16|l<<8|l;return a.putImageData(i,0,0,0,0,n,r),h=new C({canvasWidth:n,imageArray:i.data}),e.abrupt("return",h);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t,a){return B.apply(this,arguments)}function B(){return(B=Object(p.a)(g.a.mark((function e(t,a,n){var r,i,c,o,u,s,l,h,d,f,m,v,p,y,E,b,O,x,w,j,_,I;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.width,i=t.height,c={detectionWidth:r,detectionHeight:i},o=n.current,u=o.getContext("2d"),e.next=6,H(t,u);case 6:return s=e.sent,(l=a.context).drawImage(t,0,0,r,i),h=l.getImageData(0,0,r,i),d=new C({canvasWidth:c.detectionWidth,imageArray:h.data}),e.next=13,z(d,c);case 13:return f=e.sent,e.next=16,N(d,f,s,{width:r,height:i});case 16:return m=e.sent,e.next=19,V(f,m,d,r,i);case 19:return v=e.sent,e.next=22,N(d,v,s,{width:r,height:i});case 22:return p=e.sent,l.putImageData(h,0,0,0,0,c.detectionWidth,c.detectionHeight),y=m,E=p,f.y>v.y&&(y=(b=[E,y])[0],E=b[1]),e.next=29,$(y,E);case 29:return O=e.sent,x=O.left,w=O.right,j={r:0,g:255,b:0},e.next=35,M(d,{leftX:x,rightX:w,height:i},j,y);case 35:return _=e.sent,e.next=38,M(d,{leftX:x,rightX:w,height:i},{r:0,g:255,b:255},E);case 38:return I=e.sent,l.putImageData(h,0,0,0,0,c.detectionWidth,c.detectionHeight),e.abrupt("return",Promise.resolve({topPixelsCount:_,bottomPixelsCount:I,context:l}));case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e,t,a,n,r){return J.apply(this,arguments)}function J(){return(J=Object(p.a)(g.a.mark((function e(t,a,n,r,i){var c,o,u,s,l,h,d,f,m,v,p,y,E,b,O,w;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=i/2,o=r/2,u=Math.abs(t.y-c),s=t.y,h=(l=u<s)?Number.MIN_VALUE:Number.MAX_VALUE,d=l?Math.max:Math.min,f=Object(x.a)(a);try{for(f.s();!(m=f.n()).done;)v=m.value.y,h=d(h,v)}catch(g){f.e(g)}finally{f.f()}for(h+=l?-20:20,p={x:o},y=0,E=l?0:c;E!==h;)b={x:o,y:E},O=n.rgbPixel(b),(w=2*O.r-O.b-O.g)>y&&(p.y=E,y=w),l?E++:E--;return e.abrupt("return",p);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return Q.apply(this,arguments)}function Q(){return(Q=Object(p.a)(g.a.mark((function e(t,a){var n,r,i,c,o,u,s,l,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.detectionWidth,r=a.detectionHeight,c={x:i=n/2},o=0,u=0;u<r/2;u++)s={x:i,y:u},l=t.rgbPixel(s),(h=2*l.r-l.b-l.g)>o&&(c.y=u,o=h);return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return q.apply(this,arguments)}function q(){return(q=Object(p.a)(g.a.mark((function e(t,a){var n,r,i,c,o,u,s,l,h,d,f,m;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Number.MAX_VALUE,r=Number.MAX_VALUE,i=0,c=0,o=Object(x.a)(t);try{for(o.s();!(u=o.n()).done;)s=u.value,l=s.x,n=Math.min(n,l),i=Math.max(i,l)}catch(v){o.e(v)}finally{o.f()}h=Object(x.a)(a);try{for(h.s();!(d=h.n()).done;)f=d.value,m=f.x,r=Math.min(r,m),c=Math.max(c,m)}catch(v){h.e(v)}finally{h.f()}return e.abrupt("return",{left:Math.max(n,r),right:Math.min(i,c)});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=function(e){Object(m.b)(),Object(m.c)((function(e){return e.outerCanvasInfo})),Object(m.c)((function(e){return e.innerCanvasInfo}));var t,a=Object(m.c)((function(e){return e.combinedCanvasInfo})),i=(Object(m.c)((function(e){return e.canvasSettings.canvasDimensions})),Object(m.c)((function(e){return e.image.source}))),c=Object(m.c)((function(e){return e.image.image})),u=a.numColoredOuterPixels,s=a.numColoredInnerPixels,l=e.webcamRef,d=Object(h.a)({},e,{canvasContext:[a.context,y]}),f=Object(n.useRef)(null);function v(){return(v=Object(p.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(i,a,f);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex justify-content-around align-items-center"},r.a.createElement(O,d),r.a.createElement("canvas",{style:{display:"none"},ref:f}),r.a.createElement("div",null,r.a.createElement(o.a,{className:"my-1",variant:"outline-primary",onClick:function(){window.scrollTo(0,l.current.offsetTop)}},"Retake"),r.a.createElement("div",null,r.a.createElement("div",{className:"my-4"},r.a.createElement(o.a,{onClick:function(){!function(){v.apply(this,arguments)}()}},"Analyze")),r.a.createElement(o.a,{variant:"outline-primary",onClick:function(){!function(e,t){var a=document.createElement("a");a.href=e,a.download=t+".jpeg",a.click()}(c,"close")}},"Download")),r.a.createElement("div",{className:"mt-4"},"Loss:"," ",(100*((t=u)-s)/t).toFixed(4),"%"))))},Y=a(25),Z=a.n(Y),ee=(a(57),a(26)),te=a.n(ee);var ae=Object(u.withOrientationChange)((function(e){var t=Object(m.b)(),a=Object(m.c)((function(e){return e.videoReducer.videoConstraints})),i=Object(m.c)((function(e){return e.image.source})),c=Object(m.c)((function(e){return e.canvasSettings.canvasDimensions})),u=e.isPortrait,s=Object(n.useRef)(null),h=Object(n.useRef)(null),f=Object(n.useRef)(null);Object(n.useEffect)((function(){t(d(te.a))}),[]);var v=Object(n.useCallback)((function(){var e=s.current.getScreenshot();t(d(e)),t(function(e){return{type:"IMAGE_SET",payload:e}}(e)),window.scrollTo(0,f.current.offsetTop)}),[s]),g={webcamRef:s,image:i,canvasDimensions:{canvasWidth:c.width,canvasHeight:c.height},drawDimensions:{drawWidth:c.width,drawHeight:c.height}};return r.a.createElement("div",{className:"App"},r.a.createElement("h2",null,"Ptosis calculator"),u&&r.a.createElement("h5",null,"Please rotate your device"),!u&&r.a.createElement("div",{className:"d-flex justify-content-around align-items-center",ref:h},r.a.createElement("div",{style:{position:"relative",float:"top"}},r.a.createElement(l.a,{audio:!1,height:a.height,ref:s,screenshotFormat:"image/jpeg",width:a.width,videoConstraints:a}),r.a.createElement("div",{className:"overlay"},r.a.createElement("img",{className:"target",style:{height:a.height},src:Z.a}))),r.a.createElement("div",{className:"my-3"},r.a.createElement(o.a,{onClick:function(){return v()}},"Take picture"))),r.a.createElement("div",{ref:f},r.a.createElement(K,g)))}));var ne=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae,null))};var re=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(58);var ie=a(8),ce=a(27);var oe={isOuterEdit:!0};var ue={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#00FF00"};var se={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#FFA500"};var le={canvasDimensions:{width:450,height:320}};var he={videoConstraints:{width:450,height:320,facingMode:{exact:"environment"},audio:!1,imageSmoothing:!0,screenshotQuality:1}};var de=Object(ie.c)({image:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IMAGE_SOURCE_SET":return Object(h.a)({},e,{source:t.payload});case"IMAGE_SET":return Object(h.a)({},e,{image:t.payload});default:return e}},canvasEdit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_IS_OUTER_EDIT":return Object(h.a)({},e,{isOuterEdit:!e.isOuterEdit});default:return e}},innerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INNER_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_INNER_RECOLORED_IMAGE_DATA":return Object(h.a)({},e,{recoloredImageData:t.payload});case"SET_INNER_DETECTED_PIXELS":return Object(h.a)({},e,{detectedPixels:t.payload});case"SET_INNER_NUM_COLORED_PIXELS":return Object(h.a)({},e,{numColoredPixels:t.payload});case"SET_INNER_RECOLOR_HEX":return Object(h.a)({},e,{recolorHex:t.payload});default:return e}},outerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OUTER_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_OUTER_RECOLORED_IMAGE_DATA":return Object(h.a)({},e,{recoloredImageData:t.payload});case"SET_OUTER_DETECTED_PIXELS":return Object(h.a)({},e,{detectedPixels:t.payload});case"SET_OUTER_NUM_COLORED_PIXELS":return Object(h.a)({},e,{numColoredPixels:t.payload});case"SET_OUTER_RECOLOR_HEX":return Object(h.a)({},e,{recolorHex:t.payload});default:return e}},combinedCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_COMBINE_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_NUM_COLORED_INNER_PIXELS":return Object(h.a)({},e,{numColoredInnerPixels:t.payload});case"SET_NUM_COLORED_OUTER_PIXELS":return Object(h.a)({},e,{numColoredOuterPixels:t.payload});default:return e}},canvasSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CANVAS_DIMENSIONS":return Object(h.a)({},e,{source:t.payload});default:return e}},videoReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:he,t=arguments.length>1?arguments[1]:void 0;return t.type,e}}),fe=Object(ie.d)(de,Object(ie.a)(ce.a));c.a.render(r.a.createElement(m.a,{store:fe},r.a.createElement(re,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.287d2f56.chunk.js.map