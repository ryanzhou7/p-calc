(this["webpackJsonpcreate-react-plus"]=this["webpackJsonpcreate-react-plus"]||[]).push([[0],{24:function(e,t,a){e.exports=a.p+"static/media/thick-half.34a74ea6.png"},25:function(e,t,a){e.exports=a.p+"static/media/top-max.9741321e.jpeg"},28:function(e,t,a){e.exports=a(45)},33:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(11),c=a.n(i),o=(a(33),a(47)),s=a(19),u=a(20),l=a.n(u),h=a(2);function d(e){return function(t){var a=new Image;a.onload=function(){t({type:"IMAGE_SET",payload:a})},a.src=e}}var f={source:null};var m=a(5),v=a(1),g=a.n(v),p=a(3);function y(e){return{type:"SET_COMBINE_CONTEXT",payload:e}}var b={context:null,numColoredOuterPixels:0,numColoredInnerPixels:0};var E=a(9);a(42);var O=function(e){var t=Object(m.b)(),a=e.image,i=e.canvasDimensions,c=i.canvasWidth,o=i.canvasHeight,s=e.drawDimensions,u=s.drawWidth,l=s.drawHeight,h=Object(E.a)(e.canvasContext,2),d=h[0],f=h[1],v=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=v.current.getContext("2d");t(f(e))}),[]),Object(n.useEffect)((function(){if(null!=a&&null!=d){var e=v.current;e.width=c,e.height=o,d.drawImage(a,0,0,u,l)}}),[a,u,l,c,o]),r.a.createElement("div",null,r.a.createElement("canvas",{ref:v,className:"border"}))},x=a(7),w=a(12),j=function e(t){var a=t.x,n=t.y;Object(w.a)(this,e),this.x=a,this.y=n},_=a(22),C=function(){function e(t){var a=t.canvasWidth,n=t.imageArray;Object(w.a)(this,e),this.canvasWidth=a,this.imageArray=n}return Object(_.a)(e,[{key:"rgbPixel",value:function(e){var t=e.x,a=e.y,n=I(t,a,this.canvasWidth)+0,r=I(t,a,this.canvasWidth)+1,i=I(t,a,this.canvasWidth)+2,c=this.imageArray[n],o=this.imageArray[r],s=this.imageArray[i];if(0!==c&&0!==o&&0!==s){var u=I(t,a,this.canvasWidth)+3;this.imageArray[u]}return{r:c,g:o,b:s}}},{key:"rgbaPixel",value:function(e){var t=e.x,a=e.y,n=this.rgbPixel({x:t,y:a}),r=I(t,a,this.canvasWidth)+3,i=this.imageArray[r];return n.alpha=i,n}},{key:"recolor",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=I(i,c,this.canvasWidth)+0,s=I(i,c,this.canvasWidth)+1,u=I(i,c,this.canvasWidth)+2;this.imageArray[o]=Number(a),this.imageArray[s]=Number(n),this.imageArray[u]=Number(r)}},{key:"rRelative",value:function(e){var t=this.rgbPixel(e);t.r,t.g;return t.b}},{key:"tint",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=I(i,c,this.canvasWidth)+0,s=I(i,c,this.canvasWidth)+1,u=I(i,c,this.canvasWidth)+2,l=this.imageArray[o],h=this.imageArray[s],d=this.imageArray[u];this.imageArray[o]+=this.tintDelta(l,a),this.imageArray[s]+=this.tintDelta(h,n),this.imageArray[u]+=this.tintDelta(d,r)}},{key:"tintDelta",value:function(e,t){return(t-e)/3}}]),e}();function I(e,t,a){return 4*(e+t*a)}function T(e,t,a,n){return N.apply(this,arguments)}function N(){return(N=Object(p.a)(g.a.mark((function e(t,a,n,r){var i,c,o,s,u,l,h,d,f;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a.x,a.y,(i=[]).push(a),(c=[]).push(a),(o=new Set).add(a),0;c.length>0;){s=c.pop(),k(s.x,s.y),u=P(s),l=Object(x.a)(u);try{for(l.s();!(h=l.n()).done;)d=h.value,f=k(d.x,d.y),!o.has(f)&&A(s,d,t,a)&&R(d,r)&&(c.push(d),i.push(d)),o.add(f)}catch(n){l.e(n)}finally{l.f()}0}return e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(e,t,a,n){var r=a.rgbPixel(n),i=2*r.r-r.g-r.b,c=a.rgbPixel(e),o=a.rgbPixel(t);return 2*o.r-o.g-o.b+45>i&&Math.abs(c.r-o.r)<100&&Math.abs(c.g-o.g)<100&&Math.abs(c.b-o.b)<100}function R(e,t){var a=e.x,n=e.y;return a>0&&a<t.width&&n>0&&n<t.height}var S=[[-1,0],[0,-1],[0,1],[1,0]];function P(e){var t,a=[],n=e.x,r=e.y,i=Object(x.a)(S);try{for(i.s();!(t=i.n()).done;){var c=t.value,o=Object(E.a)(c,2),s=o[0],u=o[1];a.push(new j({x:s+n,y:u+r}))}}catch(l){i.e(l)}finally{i.f()}return a}function D(e,t,a,n){return M.apply(this,arguments)}function M(){return(M=Object(p.a)(g.a.mark((function e(t,a,n,r){var i,c,o,s,u,l,h,d,f,m,v,p,y;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.leftX,c=a.rightX,o=a.height,s=0,u=new Set,l=Object(x.a)(r);try{for(l.s();!(h=l.n()).done;)for(d=h.value,f=d.x,m=d.y,v=m;v<o/2;v++)p=k(f,v),y={x:f,y:v},!u.has(p)&&i<=f&&f<=c&&(u.add(p),t.tint(y,n),s++)}catch(g){l.e(g)}finally{l.f()}return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e,t){return String(e)+String(t)}var W=a(10),X=a.n(W);function L(e,t){return U.apply(this,arguments)}function U(){return(U=Object(p.a)(g.a.mark((function e(t,a){var n,r,i,c,o,s,u,l,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.width,r=t.height,a.drawImage(t,0,0,n,r),i=a.getImageData(0,0,n,r),450,320,c=X.a.U8_t,o=new X.a.matrix_t(450,320,c),X.a.imgproc.grayscale(i.data,n,r,o),3,8,120,120,X.a.imgproc.gaussian_blur(o,o,8,0),X.a.imgproc.canny(o,o,120,120),s=new Uint32Array(i.data.buffer),255<<24,u=o.cols*o.rows,l=0;--u>=0;)l=o.data[u],s[u]=255<<24|l<<16|l<<8|l;return a.putImageData(i,0,0,0,0,n,r),h=new C({canvasWidth:n,imageArray:i.data}),e.abrupt("return",h);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t,a){return F.apply(this,arguments)}function F(){return(F=Object(p.a)(g.a.mark((function e(t,a,n){var r,i,c,o,s,u,l,h,d,f,m,v,p,y,b,E,O,x,w,j,_,I;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.width,i=t.height,c={detectionWidth:r,detectionHeight:i},o=n.current,s=o.getContext("2d"),e.next=6,L(t,s);case 6:return u=e.sent,(l=a.context).drawImage(t,0,0,r,i),h=l.getImageData(0,0,r,i),d=new C({canvasWidth:c.detectionWidth,imageArray:h.data}),e.next=13,B(d,c);case 13:return f=e.sent,e.next=16,T(d,f,u,{width:r,height:i});case 16:return m=e.sent,e.next=19,G(f,m,d,r,i);case 19:return v=e.sent,e.next=22,T(d,v,u,{width:r,height:i});case 22:return p=e.sent,l.putImageData(h,0,0,0,0,c.detectionWidth,c.detectionHeight),y=m,b=p,f.y>v.y&&(y=(E=[b,y])[0],b=E[1]),e.next=29,z(y,b);case 29:return O=e.sent,x=O.left,w=O.right,j={r:0,g:255,b:0},e.next=35,D(d,{leftX:x,rightX:w,height:i},j,y);case 35:return _=e.sent,e.next=38,D(d,{leftX:x,rightX:w,height:i},{r:0,g:255,b:255},b);case 38:return I=e.sent,l.putImageData(h,0,0,0,0,c.detectionWidth,c.detectionHeight),e.abrupt("return",Promise.resolve({topPixelsCount:_,bottomPixelsCount:I,context:l}));case 41:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t,a,n,r){return V.apply(this,arguments)}function V(){return(V=Object(p.a)(g.a.mark((function e(t,a,n,r,i){var c,o,s,u,l,h,d,f,m,v,p,y,b,E,O,w;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=i/2,o=r/2,s=Math.abs(t.y-c),u=t.y,h=(l=s<u)?Number.MIN_VALUE:Number.MAX_VALUE,d=l?Math.max:Math.min,f=Object(x.a)(a);try{for(f.s();!(m=f.n()).done;)v=m.value.y,h=d(h,v)}catch(g){f.e(g)}finally{f.f()}for(h+=l?-5:5,p={x:o},y=0,b=l?0:c;b!==h;)E={x:o,y:b},O=n.rgbPixel(E),(w=2*O.r-O.b-O.g)>y&&(p.y=b,y=w),l?b++:b--;return e.abrupt("return",p);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return J.apply(this,arguments)}function J(){return(J=Object(p.a)(g.a.mark((function e(t,a){var n,r,i,c,o,s,u,l,h;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.detectionWidth,r=a.detectionHeight,c={x:i=n/2},o=0,s=0;s<r/2;s++)u={x:i,y:s},l=t.rgbPixel(u),(h=2*l.r-l.b-l.g)>o&&(c.y=s,o=h);return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t){return Q.apply(this,arguments)}function Q(){return(Q=Object(p.a)(g.a.mark((function e(t,a){var n,r,i,c,o,s,u,l,h,d,f,m;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Number.MAX_VALUE,r=Number.MAX_VALUE,i=0,c=0,o=Object(x.a)(t);try{for(o.s();!(s=o.n()).done;)u=s.value,l=u.x,n=Math.min(n,l),i=Math.max(i,l)}catch(v){o.e(v)}finally{o.f()}h=Object(x.a)(a);try{for(h.s();!(d=h.n()).done;)f=d.value,m=f.x,r=Math.min(r,m),c=Math.max(c,m)}catch(v){h.e(v)}finally{h.f()}return e.abrupt("return",{left:Math.max(n,r),right:Math.min(i,c)});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $=function(e){Object(m.b)(),Object(m.c)((function(e){return e.outerCanvasInfo})),Object(m.c)((function(e){return e.innerCanvasInfo}));var t,a=Object(m.c)((function(e){return e.combinedCanvasInfo})),i=(Object(m.c)((function(e){return e.canvasSettings.canvasDimensions})),Object(m.c)((function(e){return e.image.source}))),c=a.numColoredOuterPixels,s=a.numColoredInnerPixels,u=e.webcamRef,l=Object(h.a)({},e,{canvasContext:[a.context,y]}),d=Object(n.useRef)(null);function f(){return(f=Object(p.a)(g.a.mark((function e(){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(i,a,d);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex justify-content-around align-items-center"},r.a.createElement(O,l),r.a.createElement("canvas",{style:{display:"none"},ref:d}),r.a.createElement("div",null,r.a.createElement(o.a,{className:"my-1",variant:"outline-primary",onClick:function(){window.scrollTo(0,u.current.offsetTop)}},"Retake"),r.a.createElement("div",null,r.a.createElement("div",{className:"my-4"},r.a.createElement(o.a,{className:"mr-4",variant:"outline-primary"},"-"),r.a.createElement(o.a,{variant:"outline-primary"},"+")),r.a.createElement(o.a,{onClick:function(){!function(){f.apply(this,arguments)}()}},"Analyze")),r.a.createElement("div",{className:"mt-4"},"Loss:"," ",(100*((t=c)-s)/t).toFixed(4),"%"))))},q=a(24),K=a.n(q);a(43);var Y=a(25),Z=a.n(Y);var ee=Object(s.withOrientationChange)((function(e){var t=Object(m.b)(),a=Object(m.c)((function(e){return e.videoReducer.videoConstraints})),i=Object(m.c)((function(e){return e.image.source})),c=Object(m.c)((function(e){return e.canvasSettings.canvasDimensions})),s=e.isPortrait,u=Object(n.useRef)(null),h=Object(n.useRef)(null),f=Object(n.useRef)(null);Object(n.useEffect)((function(){t(d(Z.a))}),[]);var v=Object(n.useCallback)((function(){var e=u.current.getScreenshot();!function(e,t){var a=document.createElement("a");a.href=e,a.download=t+".jpeg",a.click()}(e,"close"),t(d(e)),window.scrollTo(0,f.current.offsetTop)}),[u]),g={webcamRef:u,image:i,canvasDimensions:{canvasWidth:c.width,canvasHeight:c.height},drawDimensions:{drawWidth:c.width,drawHeight:c.height}};return r.a.createElement("div",{className:"App"},r.a.createElement("h2",null,"Ptosis calculator"),s&&r.a.createElement("h5",null,"Please rotate your device"),!s&&r.a.createElement("div",{className:"d-flex justify-content-around align-items-center",ref:h},r.a.createElement("div",{style:{position:"relative",float:"top"}},r.a.createElement(l.a,{audio:!1,height:a.height,ref:u,screenshotFormat:"image/jpeg",width:a.width,videoConstraints:a}),r.a.createElement("div",{className:"overlay"},r.a.createElement("img",{className:"target",style:{height:a.height},src:K.a}))),r.a.createElement("div",{className:"my-3"},r.a.createElement(o.a,{onClick:function(){return v()}},"Take picture"))),r.a.createElement("div",{ref:f},r.a.createElement($,g)))}));var te=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(ee,null))};var ae=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(te,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(44);var ne=a(8),re=a(26);var ie={isOuterEdit:!0};var ce={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#00FF00"};var oe={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#FFA500"};var se={canvasDimensions:{width:450,height:320}};var ue={videoConstraints:{width:450,height:320,facingMode:{exact:"environment"},audio:!1,imageSmoothing:!0,screenshotQuality:1}};var le=Object(ne.c)({image:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IMAGE_SET":return Object(h.a)({},e,{source:t.payload});default:return e}},canvasEdit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_IS_OUTER_EDIT":return Object(h.a)({},e,{isOuterEdit:!e.isOuterEdit});default:return e}},innerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ce,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INNER_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_INNER_RECOLORED_IMAGE_DATA":return Object(h.a)({},e,{recoloredImageData:t.payload});case"SET_INNER_DETECTED_PIXELS":return Object(h.a)({},e,{detectedPixels:t.payload});case"SET_INNER_NUM_COLORED_PIXELS":return Object(h.a)({},e,{numColoredPixels:t.payload});case"SET_INNER_RECOLOR_HEX":return Object(h.a)({},e,{recolorHex:t.payload});default:return e}},outerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OUTER_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_OUTER_RECOLORED_IMAGE_DATA":return Object(h.a)({},e,{recoloredImageData:t.payload});case"SET_OUTER_DETECTED_PIXELS":return Object(h.a)({},e,{detectedPixels:t.payload});case"SET_OUTER_NUM_COLORED_PIXELS":return Object(h.a)({},e,{numColoredPixels:t.payload});case"SET_OUTER_RECOLOR_HEX":return Object(h.a)({},e,{recolorHex:t.payload});default:return e}},combinedCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_COMBINE_CONTEXT":return Object(h.a)({},e,{context:t.payload});case"SET_NUM_COLORED_INNER_PIXELS":return Object(h.a)({},e,{numColoredInnerPixels:t.payload});case"SET_NUM_COLORED_OUTER_PIXELS":return Object(h.a)({},e,{numColoredOuterPixels:t.payload});default:return e}},canvasSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CANVAS_DIMENSIONS":return Object(h.a)({},e,{source:t.payload});default:return e}},videoReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;return t.type,e}}),he=Object(ne.d)(le,Object(ne.a)(re.a));c.a.render(r.a.createElement(m.a,{store:he},r.a.createElement(ae,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[28,1,2]]]);
//# sourceMappingURL=main.8174f99f.chunk.js.map