(this["webpackJsonpcreate-react-plus"]=this["webpackJsonpcreate-react-plus"]||[]).push([[0],{111:function(e,t,a){},114:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(12),c=a.n(i),o=(a(71),a(13)),s=a(123),l=a(120),u=a(121),h=a(122),m=a(54),d=a(55),f=a.n(d),p=a(5);var g={source:null,image:null};var v=a(9),E=a(4),y=a.n(E),b=a(8);function x(e){return{type:"SET_COMBINE_CONTEXT",payload:e}}function O(e){return{type:"SET_NUM_COLORED_INNER_PIXELS",payload:e}}function w(e){return{type:"SET_NUM_COLORED_OUTER_PIXELS",payload:e}}var _={context:null,numColoredOuterPixels:0,numColoredInnerPixels:0};var j=a(14);a(81);var C=function(e){var t=Object(v.b)(),a=e.image,i=e.canvasDimensions,c=i.canvasWidth,s=i.canvasHeight,l=e.drawDimensions,u=l.drawWidth,h=l.drawHeight,m=Object(o.a)(e.canvasContext,2),d=m[0],f=m[1],p=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=p.current.getContext("2d");t(f(e))}),[]),Object(n.useEffect)((function(){if(null!=a&&null!=d){var e=p.current;e.width=c,e.height=s,d.drawImage(a,0,0,u,h)}}),[a,u,h,c,s]),r.a.createElement("div",{className:"mx-auto"},r.a.createElement("canvas",{ref:p}))},N=a(17),I=a(26),S=function e(t){var a=t.x,n=t.y;Object(I.a)(this,e),this.x=a,this.y=n},T=a(57),R=function(){function e(t){var a=t.canvasWidth,n=t.imageArray;Object(I.a)(this,e),this.canvasWidth=a,this.imageArray=n}return Object(T.a)(e,[{key:"rgbPixel",value:function(e){var t=e.x,a=e.y,n=A(t,a,this.canvasWidth)+0,r=A(t,a,this.canvasWidth)+1,i=A(t,a,this.canvasWidth)+2,c=this.imageArray[n],o=this.imageArray[r],s=this.imageArray[i];if(0!==c&&0!==o&&0!==s){var l=A(t,a,this.canvasWidth)+3;this.imageArray[l]}return{r:c,g:o,b:s}}},{key:"rgbaPixel",value:function(e){var t=e.x,a=e.y,n=this.rgbPixel({x:t,y:a}),r=A(t,a,this.canvasWidth)+3,i=this.imageArray[r];return n.alpha=i,n}},{key:"recolor",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=A(i,c,this.canvasWidth)+0,s=A(i,c,this.canvasWidth)+1,l=A(i,c,this.canvasWidth)+2;this.imageArray[o]=Number(a),this.imageArray[s]=Number(n),this.imageArray[l]=Number(r)}},{key:"tint",value:function(e,t){var a=t.r,n=t.g,r=t.b,i=e.x,c=e.y,o=A(i,c,this.canvasWidth)+0,s=A(i,c,this.canvasWidth)+1,l=A(i,c,this.canvasWidth)+2,u=this.imageArray[o],h=this.imageArray[s],m=this.imageArray[l];this.imageArray[o]+=this.tintDelta(u,a),this.imageArray[s]+=this.tintDelta(h,n),this.imageArray[l]+=this.tintDelta(m,r)}},{key:"tintDelta",value:function(e,t){return(t-e)/3}}]),e}();function A(e,t,a){return 4*(e+t*a)}var D=a(82),P=a(107);function M(e,t,a,n,r){return k.apply(this,arguments)}function k(){return(k=Object(b.a)(y.a.mark((function e(t,a,n,r,i){var c,o,s,l,u,h,m,d,f;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a.x,a.y,(c=[]).push(a),(o=[]).push(a),(s=new Set).add(a);o.length>0;){l=o.pop(),B(l.x,l.y),u=F(l),h=Object(N.a)(u);try{for(h.s();!(m=h.n()).done;)d=m.value,f=B(d.x,d.y),U(d,r)&&!s.has(f)&&X(d,t,a,i)&&(o.push(d),c.push(d)),s.add(f)}catch(n){h.e(n)}finally{h.f()}}return e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){return L.apply(this,arguments)}function L(){return(L=Object(b.a)(y.a.mark((function e(t,a){var n,r,i,c,o,s,l,u,h,m,d,f,p,g,v,E;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.width,r=a.height,i=0,c=0,o=0,0,s=0;s<n;s++)for(l=0;l<r/2;l++)Math.sqrt(Math.pow(s-200,2)+Math.pow(l-200,2))<188&&(u=t.rgbPixel({x:s,y:l}),i=Math.max(u.r,i),c=Math.max(u.g,c),o=Math.max(u.b,o));for(h=c/i,m=c/o,d=0;d<n;d++)for(f=0;f<r/2;f++)p=t.rgbPixel({x:d,y:f}),g=parseInt(p.r*h),v=p.g,E=parseInt(p.b*m),t.recolor({x:d,y:f},{r:g,g:v,b:E});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t,a,n){var r=t.rgbPixel(a),i=D.rgb.lab([r.r,r.g,r.b]),c={L:i[0],A:i[1],B:i[2]},o=t.rgbPixel(e),s=D.rgb.lab([o.r,o.g,o.b]),l={L:s[0],A:s[1],B:s[2]};return P.getDeltaE00(c,l)<n}function U(e,t){var a=e.x,n=e.y;return a>0&&a<t.width&&n>0&&n<t.height}var H=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];function F(e){var t,a=[],n=e.x,r=e.y,i=Object(N.a)(H);try{for(i.s();!(t=i.n()).done;){var c=t.value,s=Object(o.a)(c,2),l=s[0],u=s[1];a.push(new S({x:l+n,y:u+r}))}}catch(h){i.e(h)}finally{i.f()}return a}function G(e,t,a,n){return z.apply(this,arguments)}function z(){return(z=Object(b.a)(y.a.mark((function e(t,a,n,r){var i,c,o,s,l,u,h,m,d,f,p,g,v;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.leftX,c=a.rightX,o=a.height,s=0,l=new Set,u=Object(N.a)(r);try{for(u.s();!(h=u.n()).done;)for(m=h.value,d=m.x,f=m.y,p=f;p<o/2;p++)g=B(d,p),v={x:d,y:p},!l.has(g)&&i<=d&&d<=c&&(l.add(g),t.tint(v,n),s++)}catch(E){u.e(E)}finally{u.f()}return e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return String(e)+String(t)}var q=a(20),J=a.n(q);function Q(e,t,a,n){return V.apply(this,arguments)}function V(){return(V=Object(b.a)(y.a.mark((function e(t,a,n,r){var i,c,o,s,l,u,h,m,d,f,p,g,v,E,b,x,O,w,_,j;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.width,c=t.height,o={detectionWidth:i,detectionHeight:c},s=n.current,l=s.getContext("2d"),e.next=6,ne(t,l);case 6:return u=e.sent,(h=a.context).drawImage(t,0,0,i,c),m=h.getImageData(0,0,i,c),W(d=new R({canvasWidth:o.detectionWidth,imageArray:m.data}),{width:i,height:c}),e.next=14,Y(d,o);case 14:return f=e.sent,e.next=17,M(d,f,u,{width:i,height:c},r);case 17:return p=e.sent,e.next=20,$(f,d,i,c);case 20:return g=e.sent,e.next=23,M(d,g,u,{width:i,height:c},r);case 23:return v=e.sent,E=p,b=v,f.y>g.y&&(E=(x=[b,E])[0],b=x[1]),e.next=29,ee(E,b);case 29:return O=e.sent,w={r:0,g:255,b:0},e.next=33,G(d,{leftX:O.top.left.x,rightX:O.top.right.x,height:c},w,E);case 33:return _=e.sent,e.next=36,G(d,{leftX:O.bottom.left.x,rightX:O.bottom.right.x,height:c},{r:0,g:0,b:255},b);case 36:return j=e.sent,h.putImageData(m,0,0,0,0,o.detectionWidth,o.detectionHeight),e.abrupt("return",Promise.resolve({topPixelsCount:_,bottomPixelsCount:j}));case 39:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t,a,n){return K.apply(this,arguments)}function K(){return(K=Object(b.a)(y.a.mark((function e(t,a,n,r){var i,c,o,s,l,u,h,m,d,f,p,g;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=r/2,c=n/2,o=Math.abs(t.y-i),s=t.y,u=s,u+=(l=o<s)?-5:5,h={x:c},m=Number.MIN_SAFE_INTEGER,d=l?12:i;d!==u;)f={x:c,y:d},p=a.rgbPixel(f),(g=2*p.r-p.b-p.g)>m&&(h={y:d,x:c},m=g),l?d++:d--;return e.abrupt("return",h);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(b.a)(y.a.mark((function e(t,a){var n,r,i,c,o,s,l,u,h;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.detectionWidth,r=a.detectionHeight,c={x:i=n/2},o=0,s=12;s<r/2;s++)l={x:i,y:s},u=t.rgbPixel(l),(h=2*u.r-u.b-u.g)>o&&(c.y=s,o=h);return e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(e,t){return te.apply(this,arguments)}function te(){return(te=Object(b.a)(y.a.mark((function e(t,a){var n,r,i;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=ae(t,a)).top.left.y>182&&n.bottom.left.y>182||n.bottom.left.y>182&&n.top.left.x<n.bottom.left.x||(r=Math.max(n.top.left.x,n.bottom.left.x),n.top.left.x=r,n.bottom.left.x=r),n.top.right.y>182&&n.bottom.right.y>182||n.bottom.right.y>182&&n.top.right.x>n.bottom.right.x||(i=Math.min(n.top.right.x,n.bottom.right.x),n.top.right.x=i,n.bottom.right.x=i),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e,t){var a,n={top:{left:{x:Number.MAX_SAFE_INTEGER,y:void 0},right:{x:0,y:void 0}},bottom:{left:{x:Number.MAX_SAFE_INTEGER,y:void 0},right:{x:0,y:void 0}}},r=Object(N.a)(e);try{for(r.s();!(a=r.n()).done;){var i=a.value,c=i.x,o=i.y;c<n.top.left.x&&(n.top.left.x=c,n.top.left.y=o),c>n.top.right.x&&(n.top.right.x=c,n.top.right.y=o)}}catch(d){r.e(d)}finally{r.f()}var s,l=Object(N.a)(t);try{for(l.s();!(s=l.n()).done;){var u=s.value,h=u.x,m=u.y;h<n.bottom.left.x&&(n.bottom.left.x=h,n.bottom.left.y=m),h>n.bottom.right.x&&(n.bottom.right.x=h,n.bottom.right.y=m)}}catch(d){l.e(d)}finally{l.f()}return n}function ne(e,t){return re.apply(this,arguments)}function re(){return(re=Object(b.a)(y.a.mark((function e(t,a){var n,r,i,c,o,s,l,u,h;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=t.width,r=t.height,a.drawImage(t,0,0,n,r),i=a.getImageData(0,0,n,r),450,320,c=J.a.U8_t,o=new J.a.matrix_t(450,320,c),J.a.imgproc.grayscale(i.data,n,r,o),3,8,120,120,J.a.imgproc.gaussian_blur(o,o,8,0),J.a.imgproc.canny(o,o,120,120),s=new Uint32Array(i.data.buffer),255<<24,l=o.cols*o.rows,u=0;--l>=0;)u=o.data[l],s[l]=255<<24|u<<16|u<<8|u;return a.putImageData(i,0,0,0,0,n,r),h=new R({canvasWidth:n,imageArray:i.data}),e.abrupt("return",h);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ie=function(e){var t,a=Object(v.b)(),i=Object(v.c)((function(e){return e.combinedCanvasInfo})),c=Object(v.c)((function(e){return e.image.source})),s=Object(v.c)((function(e){return e.image.image})),l=Object(o.a)(e.thresholdState,2),m=l[0],d=l[1],f=i.numColoredOuterPixels,g=i.numColoredInnerPixels,E=e.webcamContainerRef,_=Object(o.a)(e.cameraState,2)[1],N=Object(p.a)({},e,{canvasContext:[i.context,x]}),I=Object(n.useRef)(null);function S(e){d((function(t){return Math.max(0,t+e)}))}function T(){return(T=Object(b.a)(y.a.mark((function e(){var t,n,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q(c,i,I,m);case 2:t=e.sent,n=t.topPixelsCount,r=t.bottomPixelsCount,a(w(n)),a(O(r));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){c&&function(){T.apply(this,arguments)}()}),[c,m]),r.a.createElement(u.a,null,c&&r.a.createElement("h2",{className:"card-title"},"Results"),r.a.createElement("div",null,r.a.createElement(C,N),c&&r.a.createElement("div",{className:"d-flex justify-content-around align-items-center mb-4"},r.a.createElement("div",null,r.a.createElement(h.a,{variant:"outline-primary",onClick:function(){_(!0),window.scrollTo(0,E.current.offsetTop)}},"Retake picture"),r.a.createElement("div",null,r.a.createElement("h3",{className:"mt-4"},"Loss:"," ",(100*((t=f)-g)/t).toFixed(2),"%"),r.a.createElement("div",{className:"mt-4"},r.a.createElement(h.a,{variant:"outline-primary",onClick:function(){var e=new Date;!function(e,t){var a=document.createElement("a");a.href=e,a.download=t+".jpeg",a.click()}(s,e.toDateString())}},"Download original")," "))),r.a.createElement(u.a,null,r.a.createElement(u.a.Body,null,r.a.createElement(u.a.Title,null,"Sensitivity: ",m),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row justify-content-around mb-3"},r.a.createElement(h.a,{onClick:function(e){S(-1)}},r.a.createElement(j.a,{icon:"minus",size:"1x"})),r.a.createElement(h.a,{onClick:function(e){S(1)}},r.a.createElement(j.a,{icon:"plus",size:"1x"}))),r.a.createElement("div",{className:"row justify-content-between"},r.a.createElement(h.a,{className:"mr-1",onClick:function(e){S(-3)}},r.a.createElement(j.a,{icon:"minus",size:"1x"}),"  ",r.a.createElement(j.a,{icon:"minus",size:"1x"})),r.a.createElement(h.a,{onClick:function(e){S(3)}},r.a.createElement(j.a,{icon:"plus",size:"1x"}),"  ",r.a.createElement(j.a,{icon:"plus",size:"1x"})))))))),r.a.createElement("canvas",{style:{display:"none"},ref:I}))},ce=a(59),oe=a.n(ce);a(111);var se=Object(m.withOrientationChange)((function(e){var t=Object(v.b)(),a=Object(n.useState)(20),i=Object(o.a)(a,2),c=i[0],m=i[1],d=Object(n.useState)(!0),p=Object(o.a)(d,2),g=p[0],E=p[1],y=Object(v.c)((function(e){return e.videoReducer.videoConstraints})),b=Object(v.c)((function(e){return e.image.source})),x=Object(v.c)((function(e){return e.canvasSettings.canvasDimensions})),O=(Object(v.c)((function(e){return e.combinedCanvasInfo})),e.isPortrait),w=Object(n.useRef)(null),_=Object(n.useRef)(null),C=Object(n.useRef)(null);Object(n.useEffect)((function(){}),[]);var N=function(){if(g){m(20);var e,a=_.current.getScreenshot();t((e=a,function(t){var a=new Image;a.onload=function(){t({type:"IMAGE_SOURCE_SET",payload:a})},a.src=e})),t(function(e){return{type:"IMAGE_SET",payload:e}}(a)),window.scrollTo(0,C.current.offsetTop),E(!1),a}else E(!0)},I={webcamRef:_,webcamContainerRef:w,image:b,canvasDimensions:{canvasWidth:x.width,canvasHeight:x.height},drawDimensions:{drawWidth:x.width,drawHeight:x.height},isPortrait:O,thresholdState:[c,m],cameraState:[g,E]},S=r.a.createElement(s.a,{id:"popover-basic"},r.a.createElement(s.a.Content,null,"Draw your chart with red sharpie. Align the red target's circle concentrically with the chart's smallest circle that still encompasses all of the the drawn lines for increased accuracy. Also ensure the target cross is aligned with the chart. Camera focus will happen automatically. Tap the (?) again to close this popover."));return r.a.createElement("div",{className:"App mt-2"},r.a.createElement("h2",{className:"card-title",style:{display:"inline"}},"Capture chart"," "),r.a.createElement(l.a,{trigger:"click",placement:"bottom",overlay:S},r.a.createElement(j.a,{icon:"question-circle",size:"2x"})),r.a.createElement(u.a,{className:"mt-4"},r.a.createElement("div",{className:"mx-auto"},r.a.createElement("div",{className:"capture-container mx-auto",ref:w},g&&r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,{ref:_,audio:!1,height:y.height,screenshotFormat:"image/jpeg",width:y.width,videoConstraints:y}),r.a.createElement("div",{className:"overlay"},r.a.createElement("img",{className:"target",style:{width:y.width-20},src:oe.a}))))),r.a.createElement("div",{className:"my-2 z-top mx-auto"},r.a.createElement(h.a,{className:"capture-button",onClick:function(){return N()}},r.a.createElement(j.a,{icon:"camera",size:"3x"})))),r.a.createElement("div",{className:"mt-4",ref:C},r.a.createElement(ie,I)),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null))})),le=a(21),ue=a(60),he=a(22);le.b.add(ue.a,he.b,he.c,he.a,he.d);var me=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(se,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(113);var de=a(19),fe=a(61);var pe={isOuterEdit:!0};var ge={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#00FF00"};var ve={context:null,recoloredImageData:null,numColoredPixels:0,detectedPixels:[],recolorHex:"#FFA500"};var Ee={canvasDimensions:{width:400,height:400}};var ye={videoConstraints:{width:400,height:400,facingMode:{exact:"environment"},audio:!1,imageSmoothing:!0,screenshotQuality:1}};var be=Object(de.c)({image:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IMAGE_SOURCE_SET":return Object(p.a)({},e,{source:t.payload});case"IMAGE_SET":return Object(p.a)({},e,{image:t.payload});default:return e}},canvasEdit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE_IS_OUTER_EDIT":return Object(p.a)({},e,{isOuterEdit:!e.isOuterEdit});default:return e}},innerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_INNER_CONTEXT":return Object(p.a)({},e,{context:t.payload});case"SET_INNER_RECOLORED_IMAGE_DATA":return Object(p.a)({},e,{recoloredImageData:t.payload});case"SET_INNER_DETECTED_PIXELS":return Object(p.a)({},e,{detectedPixels:t.payload});case"SET_INNER_NUM_COLORED_PIXELS":return Object(p.a)({},e,{numColoredPixels:t.payload});case"SET_INNER_RECOLOR_HEX":return Object(p.a)({},e,{recolorHex:t.payload});default:return e}},outerCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ve,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OUTER_CONTEXT":return Object(p.a)({},e,{context:t.payload});case"SET_OUTER_RECOLORED_IMAGE_DATA":return Object(p.a)({},e,{recoloredImageData:t.payload});case"SET_OUTER_DETECTED_PIXELS":return Object(p.a)({},e,{detectedPixels:t.payload});case"SET_OUTER_NUM_COLORED_PIXELS":return Object(p.a)({},e,{numColoredPixels:t.payload});case"SET_OUTER_RECOLOR_HEX":return Object(p.a)({},e,{recolorHex:t.payload});default:return e}},combinedCanvasInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_COMBINE_CONTEXT":return Object(p.a)({},e,{context:t.payload});case"SET_NUM_COLORED_INNER_PIXELS":return Object(p.a)({},e,{numColoredInnerPixels:t.payload});case"SET_NUM_COLORED_OUTER_PIXELS":return Object(p.a)({},e,{numColoredOuterPixels:t.payload});default:return e}},canvasSettings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ee,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CANVAS_DIMENSIONS":return Object(p.a)({},e,{source:t.payload});default:return e}},videoReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye,t=arguments.length>1?arguments[1]:void 0;return t.type,e}}),xe=Object(de.d)(be,Object(de.a)(fe.a));c.a.render(r.a.createElement(v.a,{store:xe},r.a.createElement(me,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},59:function(e,t,a){e.exports=a.p+"static/media/circle.9036c121.png"},66:function(e,t,a){e.exports=a(114)},71:function(e,t,a){},81:function(e,t,a){}},[[66,1,2]]]);
//# sourceMappingURL=main.3d4553d9.chunk.js.map